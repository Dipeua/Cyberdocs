SameSite est un mécanisme de sécurité de navigateur qui détermine si les cookies d'un site web sont inclus dans les requêtes provenant d'autres sites web. Les restrictions de cookies SameSite offrent une protection partielle contre diverses attaques intersites, notamment les attaques CSRF, les fuites intersites et certaines failles CORS.

[Methode de contouneme de SamSite](./Bypassing%20CSRF/Bypassing%20SameSite%20cookie%20restrictions)

### Différence entre un site et une origine

La différence entre un site et une origine réside dans leur portée : un site englobe plusieurs noms de domaine, tandis qu'une origine n'en inclut qu'un seul.

| **Demande de**            | **Demande de**                 | **Sur le même site ?**    | **Même origine ?**                |
| ------------------------- | ------------------------------ | ------------------------- | --------------------------------- |
| `https://example.com`     | `https://example.com`          | Oui                       | Oui                               |
| `https://app.example.com` | `https://intranet.example.com` | Oui                       | Non : nom de domaine incompatible |
| `https://example.com`     | `https://example.com:8080`     | Oui                       | Non : port incompatible           |
| `https://example.com`     | `https://example.co.uk`        | Non : eTLD incompatible   | Non : nom de domaine incompatible |
| `https://example.com`     | `http://example.com`           | Non : schéma incompatible | Non : schéma incompatible         |

> Il s'agit d'une distinction importante, car elle signifie que toute vulnérabilité permettant l'exécution arbitraire de JavaScript peut être exploitée pour contourner les défenses du site sur d'autres domaines appartenant au même site. 

### Comment fonctionne SameSite ?

**Un cookie**, c’est comme un badge d’accès que ton navigateur garde pour prouver que tu es connecté à un site.

**Avant**, ton navigateur donnait ce badge à n’importe quelle requête envoyée vers ce site, même si la requête venait d’un autre site (par exemple : tu es connecté à ta banque, et tu visites un autre site qui envoie en douce une requête à ta banque → ton badge est transmis).

**Avec SameSite**, le navigateur peut dire :

- « Je ne donne le badge **que si la requête vient directement du vrai site**. »    
- Donc, si un site tiers essaie d’envoyer une requête à ta banque, ton badge (cookie) n’est **pas transmis**.

Tous les principaux navigateurs prennent actuellement en charge les niveaux de restriction SameSite suivants :

- Strict
- Lax
- None

Les développeurs peuvent configurer manuellement un niveau de restriction pour chaque cookie qu'ils installent, ce qui leur donne plus de contrôle sur leur utilisation. Pour ce faire, il leur suffit d'inclure l'attribut `SameSite` dans l'en-tête de réponse `Set-Cookie`, accompagné de leur valeur préférée :

```
Set-Cookie: session=0F8tgdOhi9ynR1M9wa3ODa; SameSite=Strict
```

Bien que cela offre une certaine protection contre les attaques CSRF, aucune de ces restrictions ne garantit une immunité.

### Strict

Avec `SameSite=Strict` le cookie est envoyé uniquement quand la requête vient du même site. Donc, si tu es connecté sur **siteA.com** et qu’un autre site (**siteB.com**) fait une requête vers **siteA.com**, ton cookie de connexion ne sera pas envoyé.

Ça protège contre les attaques CSRF et évite que d’autres sites utilisent ton cookie sans ton accord.    
C’est la **sécurité maximale**, mais ça peut gêner si on veut partager des infos entre sites.

### Lax

Avec `SameSite=Lax` le cookie est envoyé vers un autre site seulement si c’est une requête **GET et est déclenchée directement par l’utilisateur (ex : clic sur un lien)**.  

Il n’est pas envoyé pour les requêtes POST ou en arrière-plan (script, iframe, image, etc.).  
C’est un bon compromis : protège contre la plupart des attaques CSRF tout en gardant une navigation intersite basique possible.

### None

Avec `SameSite=None` le cookie est envoyé dans toutes les requêtes (même depuis des sites tiers)

 il est Utilisé pour des cookies légitimes en contexte tiers (ex : pub, suivi) mais dangereux pour cookies sensibles. et doit obligatoirement être accompagné de **Secure** (seulement via HTTPS)

```
`Set-Cookie: trackingId=0F8tgdOhi9ynR1M9wa3ODa; SameSite=None; Secure`
```

### Comparatif SameSite pour les cookies

| Mode       | Quand le cookie est envoyé ?                                                   | Sécurité                                                | Usage typique                                       |
| ---------- | ------------------------------------------------------------------------------ | ------------------------------------------------------- | --------------------------------------------------- |
| **Strict** | Seulement si la requête vient **du même site**                                 | 🔒 Très élevé                                           | Cookies de session, authentification                |
| **Lax**    | Vers d’autres sites **seulement** pour des requêtes **GET + clic utilisateur** | ⚖️ Moyen (bon compromis)                                | Navigation intersite simple (ex : clic sur un lien) |
| **None**   | Dans **toutes les requêtes**, même depuis des sites tiers                      | ⚠️ Faible (mais nécessite `Secure` = HTTPS obligatoire) | Cookies tiers (pub, suivi, intégration externe)     |

- **Strict** = ultra-sécurisé, mais limité.
- **Lax** = compromis sécurité + utilisabilité.    
- **None** = liberté totale, mais dangereux sans HTTPS.

[Methode de contouneme de SamSite](./Bypassing%20CSRF/Bypassing%20SameSite%20cookie%20restrictions)

