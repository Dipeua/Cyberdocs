SameSite est un mÃ©canisme de sÃ©curitÃ© de navigateur qui dÃ©termine si les cookies d'un site web sont inclus dans les requÃªtes provenant d'autres sites web. Les restrictions de cookies SameSite offrent une protection partielle contre diverses attaques intersites, notamment les attaques CSRF, les fuites intersites et certaines failles CORS.

[Methode de contouneme de SamSite](./Bypassing%20CSRF/Bypassing%20SameSite%20cookie%20restrictions)

### DiffÃ©rence entre un site et une origine

La diffÃ©rence entre un site et une origine rÃ©side dans leur portÃ©eÂ : un site englobe plusieurs noms de domaine, tandis qu'une origine n'en inclut qu'un seul.

| **Demande de**            | **Demande de**                 | **Sur le mÃªme site ?**    | **MÃªme origine ?**                |
| ------------------------- | ------------------------------ | ------------------------- | --------------------------------- |
| `https://example.com`     | `https://example.com`          | Oui                       | Oui                               |
| `https://app.example.com` | `https://intranet.example.com` | Oui                       | NonÂ : nom de domaine incompatible |
| `https://example.com`     | `https://example.com:8080`     | Oui                       | NonÂ : port incompatible           |
| `https://example.com`     | `https://example.co.uk`        | NonÂ : eTLD incompatible   | NonÂ : nom de domaine incompatible |
| `https://example.com`     | `http://example.com`           | Non : schÃ©ma incompatible | Non : schÃ©ma incompatible         |

> Il s'agit d'une distinction importante, car elle signifie que toute vulnÃ©rabilitÃ© permettant l'exÃ©cution arbitraire de JavaScript peut Ãªtre exploitÃ©e pour contourner les dÃ©fenses du site sur d'autres domaines appartenant au mÃªme site. 

### Comment fonctionne SameSite ?

**Un cookie**, câ€™est comme un badge dâ€™accÃ¨s que ton navigateur garde pour prouver que tu es connectÃ© Ã  un site.

**Avant**, ton navigateur donnait ce badge Ã  nâ€™importe quelle requÃªte envoyÃ©e vers ce site, mÃªme si la requÃªte venait dâ€™un autre site (par exemple : tu es connectÃ© Ã  ta banque, et tu visites un autre site qui envoie en douce une requÃªte Ã  ta banque â†’ ton badge est transmis).

**Avec SameSite**, le navigateur peut dire :

- Â« Je ne donne le badge **que si la requÃªte vient directement du vrai site**. Â»    
- Donc, si un site tiers essaie dâ€™envoyer une requÃªte Ã  ta banque, ton badge (cookie) nâ€™est **pas transmis**.

Tous les principaux navigateurs prennent actuellement en charge les niveaux de restriction SameSite suivants :

- Strict
- Lax
- None

Les dÃ©veloppeurs peuvent configurer manuellement un niveau de restriction pour chaque cookie qu'ils installent, ce qui leur donne plus de contrÃ´le sur leur utilisation. Pour ce faire, il leur suffit d'inclure l'attribut `SameSite` dans l'en-tÃªte de rÃ©ponse `Set-Cookie`, accompagnÃ© de leur valeur prÃ©fÃ©rÃ©e :

```
Set-Cookie: session=0F8tgdOhi9ynR1M9wa3ODa; SameSite=Strict
```

Bien que cela offre une certaine protection contre les attaques CSRF, aucune de ces restrictions ne garantit une immunitÃ©.

### Strict

Avec `SameSite=Strict` le cookie est envoyÃ© uniquement quand la requÃªte vient du mÃªme site. Donc, si tu es connectÃ© sur **siteA.com** et quâ€™un autre site (**siteB.com**) fait une requÃªte vers **siteA.com**, ton cookie de connexion ne sera pas envoyÃ©.

Ã‡a protÃ¨ge contre les attaques CSRF et Ã©vite que dâ€™autres sites utilisent ton cookie sans ton accord.    
Câ€™est la **sÃ©curitÃ© maximale**, mais Ã§a peut gÃªner si on veut partager des infos entre sites.

### Lax

Avec `SameSite=Lax` le cookie est envoyÃ© vers un autre site seulement si câ€™est une requÃªte **GET et est dÃ©clenchÃ©e directement par lâ€™utilisateur (ex : clic sur un lien)**.  

Il nâ€™est pas envoyÃ© pour les requÃªtes POST ou en arriÃ¨re-plan (script, iframe, image, etc.).  
Câ€™est un bon compromis : protÃ¨ge contre la plupart des attaques CSRF tout en gardant une navigation intersite basique possible.

### None

Avec `SameSite=None` le cookie est envoyÃ© dans toutes les requÃªtes (mÃªme depuis des sites tiers)

 il est UtilisÃ© pour des cookies lÃ©gitimes en contexte tiers (ex : pub, suivi) mais dangereux pour cookies sensibles. et doit obligatoirement Ãªtre accompagnÃ© de **Secure** (seulement via HTTPS)

```
`Set-Cookie: trackingId=0F8tgdOhi9ynR1M9wa3ODa; SameSite=None; Secure`
```

### Comparatif SameSite pour les cookies

| Mode       | Quand le cookie est envoyÃ© ?                                                   | SÃ©curitÃ©                                                | Usage typique                                       |
| ---------- | ------------------------------------------------------------------------------ | ------------------------------------------------------- | --------------------------------------------------- |
| **Strict** | Seulement si la requÃªte vient **du mÃªme site**                                 | ğŸ”’ TrÃ¨s Ã©levÃ©                                           | Cookies de session, authentification                |
| **Lax**    | Vers dâ€™autres sites **seulement** pour des requÃªtes **GET + clic utilisateur** | âš–ï¸ Moyen (bon compromis)                                | Navigation intersite simple (ex : clic sur un lien) |
| **None**   | Dans **toutes les requÃªtes**, mÃªme depuis des sites tiers                      | âš ï¸ Faible (mais nÃ©cessite `Secure` = HTTPS obligatoire) | Cookies tiers (pub, suivi, intÃ©gration externe)     |

- **Strict** = ultra-sÃ©curisÃ©, mais limitÃ©.
- **Lax** = compromis sÃ©curitÃ© + utilisabilitÃ©.    
- **None** = libertÃ© totale, mais dangereux sans HTTPS.

[Methode de contouneme de SamSite](./Bypassing%20CSRF/Bypassing%20SameSite%20cookie%20restrictions)

